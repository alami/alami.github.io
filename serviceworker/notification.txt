notification.txt
-20190219
https://habr.com/ru/post/321924/
  https://firebase.google.com/docs/cloud-messaging/

Варианты уведомления
- оперативные - push-сервис, дублировать на почту т.к. могут теряться
  - появлении нового фильма в сериале, на который подписан пользователь;
  - изменение статуса заказа фильма;
  - изменении статуса обращения пользователя в службу техподдержки;
  - ответ на комментарий пользователя;
- неоперативные - на почту
  - новая партия фильмов на сайте
  - рекламная акция на сайте

   +---------4--------------+
   | +---2------> Сервер уведомлений(Firebase Cloud Messaging)
  \/ |                      ^4
клиент <--1------ Front[End]Back
     |                      ^
     +-------3--------------+

(1) JS Front-a пользователю на странице или всплывающем окне предлагает получать уведомления;
Если Клиент нажмет "согласен", то
   (2) JS подключается к серверу уведомлений, регистрируется и получает ID;
   (3) JS отправляет полученный ID на Back для
      (1)идентифиция клиента и 2)привязки его к конкретному устройству используя его ID устройства;
      Инициализируется JS-воркер, который
      (1)будет работать в фоне,подключаясь к серверу уведомлений в ожидании новых поступлений (?callback)
       2)получать сообщения от сервера уведомлений и 3)показывать их пользователю)
      - переключатель для подписки и отписки от уведомлений.
(4)Back отправляет сообщение клиенту через сервер уведомлений используя полученный ранее ID устройства.

Back Миграции
? таблицы id клиентов <-N--N-> id уведомленией, чтобы отправлять персонализированные сообщения;
  таблицы id клиентов <-N--N-> ID устройства, т.к.
    у пользователя может быть несколько устройств,
    у устройства могут пользоваться несколько пользователей;
? cron рассылки, демоны/воркеры которые разбирают очередь (RabbitMQ, Redis)
  Отправка уведомлений пользователям не самая дешевая операция
     и поэтому событие, инициирующее отправку уведомления, нужно ставить в очередь на отправку(RabbitMQ, Redis),
     а не в течении того-же HTTP запроса;;
     распараллелить процесс и разнести его на несколько нод для скорости отправки
? кто и как создает ID устройства (IP/port, CPU/soft)
? как сервер уведомлений привязывается к конкретному устройству

 Sender ID который мы получили после регистрации в Firebase.